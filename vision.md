# Техническое видение проекта

> Десктоп-приложение для управления и мониторинга тестовых сред

---

## 1. Технологии

| Компонент | Технология | Обоснование |
|-----------|------------|-------------|
| Язык | Python 3.11+ | Стабильная версия с современными возможностями |
| UI-фреймворк | PyQt6 | Кроссплатформенный, современный внешний вид |
| Стилизация UI | QSS (Qt Style Sheets) | Кастомизация интерфейса |
| HTTP-клиент | requests | Простота, синхронные REST-запросы |
| Работа с БД | psycopg2 | Нативный драйвер PostgreSQL |
| Асинхронность | QThread | Фоновые задачи без блокировки UI |
| Конфигурация | YAML-файл | Человекочитаемый формат настроек |

---

## 2. Принципы разработки

| Принцип | Описание |
|---------|----------|
| KISS | Простота во всём — минимум абстракций, понятный код |
| MVP-first | Сначала минимально работающий продукт, улучшения потом |
| Без оверинжиниринга | Не создаём "на будущее", решаем текущие задачи |
| Читаемость > краткость | Код должен быть понятен без комментариев |

**Инструменты разработки:**
- Форматирование: `black`
- Тестирование: `pytest` (добавляем на этапе MVP)
- Тип разработки: solo

---

## 3. Структура проекта

```
tuda-suda-app/
├── src/
│   ├── main.py              # Точка входа
│   ├── main_window.py       # Главное окно с вкладками
│   ├── widgets/             # UI-компоненты
│   ├── services/            # Логика работы с API и БД
│   └── config.py            # Работа с конфигурацией
├── tests/                   # Тесты
├── config.yaml              # Файл конфигурации
├── requirements.txt         # Зависимости
└── README.md
```

**UI-структура:** одно главное окно с боковой навигацией (QStackedWidget + QListWidget)

---

## 4. Архитектура проекта

Простая слоистая архитектура:

```
┌─────────────────────────────────────┐
│          UI (PyQt6 виджеты)         │  ← Отображение, обработка действий
├─────────────────────────────────────┤
│           Services                  │  ← Бизнес-логика, запросы к стендам
├─────────────────────────────────────┤
│      API Client / DB Client         │  ← REST-запросы, SQL-запросы
└─────────────────────────────────────┘
```

**Принципы:**
- UI-слой — только отображение и реакция на действия пользователя
- Services — вся логика (опрос стендов, обработка данных)
- Clients — низкоуровневая работа с HTTP и PostgreSQL
- Никаких DI-контейнеров и абстрактных репозиториев
- Простой импорт модулей

---

## 5. Модель данных

### Конфигурация (config.yaml):

```yaml
# Проверка VPN
vpn_checks:
  - name: "Corporate VPN"
    check_url: "https://internal.corp.com/health"

# Стенды
stands:
  - name: "DEV-1"
    api_url: "https://dev1.example.com/api"
    db_host: "dev1-db.example.com"
    db_port: 5432
    db_name: "app_db"
    db_user: "app_user"
    db_password: "secret"

# Параметры получения токена
token_api:
  endpoint: "/auth/token"
```

### Данные в памяти (runtime):

| Сущность | Поля |
|----------|------|
| Статус стенда | name, status (online/offline/unknown), version |
| VPN-статус | name, available (true/false) — для каждого из 2 VPN |

### Данные в БД стендов:

| Таблица | Поля для работы |
|---------|-----------------|
| users (или аналог) | email, role |

---

## 6. Мониторинг

| Что | Как | Частота |
|-----|-----|---------|
| VPN-статус | 2 индикатора в шапке (зелёный/красный) | Автоматически каждые 30 сек |
| Статус стендов | Список с цветовой индикацией | По кнопке "Обновить" |
| Ошибки операций | Раздел "Логи" | В реальном времени |

**Без внешних систем мониторинга** — всё локально в приложении.

---

## 7. Сценарии работы

| # | Сценарий | Шаги |
|---|----------|------|
| 1 | Запуск приложения | Загрузка конфига → Проверка VPN → Отображение главного окна |
| 2 | Проверка статуса стендов | Клик "Обновить" → REST-запросы к стендам → Отображение статуса и версии |
| 3 | Получение токена | Выбор стенда → Клик "Получить" → API-запрос → Вывод токена + копирование в буфер |
| 4 | Смена роли пользователя | Выбор стенда → Ввод email → Клик "Сделать админом/юзером" → UPDATE в БД → Подтверждение |

**Обработка ошибок:** каждый шаг логируется в раздел "Логи", при ошибке — сообщение с описанием проблемы.

---

## 8. Деплой

**Инструмент сборки:** PyInstaller

**Целевые ОС:**
- Linux
- Windows

**Команда сборки:**
```bash
pyinstaller --onefile --windowed src/main.py
```

**Артефакты:**
- `dist/main` (Linux)
- `dist/main.exe` (Windows)

**Примечание:** сборка выполняется на соответствующей ОС (Linux-билд на Linux, Windows-билд на Windows).

---

## 9. Подход к конфигурированию

**Файл:** `config.yaml` (рядом с исполняемым файлом)

**Формат:** YAML

**Пример структуры:**
```yaml
vpn_checks:
  - name: "Corporate VPN"
    check_url: "https://internal.corp.com/health"

stands:
  - name: "DEV-1"
    api_url: "https://dev1.example.com/api"
    db_host: "dev1-db.example.com"
    db_port: 5432
    db_name: "app_db"
    db_user: "app_user"
    db_password: "secret"

token_api:
  endpoint: "/auth/token"
```

**Принципы:**
- Один файл — вся конфигурация
- Пароли хранятся открыто (внутренний инструмент)
- Редактирование вручную (без UI)
- При отсутствии файла — ошибка при запуске

---

## 10. Подход к логгированию

**Где:** отдельная вкладка "Логи" в приложении

**Формат:**
```
[2025-01-15 10:23:45] INFO: Проверка VPN...
[2025-01-15 10:23:46] OK: Corporate VPN доступен
[2025-01-15 10:23:50] ERROR: DEV-1 недоступен: Connection timeout
```

**Уровни:**
- `INFO` — обычные действия
- `OK` — успешные операции
- `ERROR` — ошибки

**Принципы:**
- Все действия логируются в реальном времени
- Лог очищается при перезапуске приложения
- Без записи в файл (только в UI)

---

## Сводка: Структура интерфейса

```
┌─────────────────────────────────────────────────────────┐
│  Tuda-Suda App          [●] VPN-1   [●] VPN-2          │
├────────────┬────────────────────────────────────────────┤
│            │                                            │
│  Стенды    │                                            │
│  Токен     │          Содержимое раздела                │
│  Роли      │                                            │
│  Логи      │                                            │
│            │                                            │
└────────────┴────────────────────────────────────────────┘
```

**Навигация:** боковая панель слева

**Разделы:**
1. **Стенды** — список стендов, статус, версия, кнопка "Обновить"
2. **Токен** — выбор стенда, кнопка "Получить токен", вывод результата
3. **Роли** — выбор стенда, ввод email, кнопки управления ролью
4. **Логи** — текстовый лог всех операций

**VPN-индикаторы:** два индикатора в шапке (для двух разных VPN)


