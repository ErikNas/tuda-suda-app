# Отчёт о сборке (25.12.2024)

## Статус ✅ УСПЕШНО

Приложение Tuda-Suda успешно собрано для Linux.

---

## Информация о сборке

| Параметр | Значение |
|----------|----------|
| **ОС** | Linux (x86-64) |
| **Python** | 3.12.7 |
| **PySide6** | 6.10.1 |
| **PyInstaller** | 6.17.0 |
| **Размер бинарника** | 195 MB |
| **Тип файла** | ELF 64-bit LSB executable |
| **Местоположение** | `dist/tuda-suda` |

---

## Установленные зависимости

```
psycopg                   3.3.2
pydantic                  2.12.5
pydantic_core             2.41.5
PySide6                   6.10.1
PySide6_Addons            6.10.1
PySide6_Essentials        6.10.1
PyYAML                    6.0.3
requests                  2.32.5
black                     24.10.0
pyinstaller               6.17.0
pytest                    8.4.2
pytest-mock               3.15.1
```

---

## Что было исправлено

### Проблема с Poetry
- **Причина:** Конфликт версий между `poetry`, `poetry-plugin-export` и `poetry-core` в системных пакетах ALT Linux
- **Решение:** Переустановка Poetry через `pipx` (версия 2.2.1)

### Проблема с PySide6
- **Причина:** PySide6 ^6.6 не поддерживает Python 3.12+
- **Решение:** Обновление на PySide6 ^6.10, который поддерживает Python 3.12

### Проблема с зависимостями Python
- **Причина:** Версия Python не совпадала с требованиями `pyproject.toml`
- **Решение:** Обновлены требования на `python = ">=3.12,<3.14"`

### Проблема с GLIBC (кроссплатформенность)
- **Причина:** Дистрибутив собран на системе с GLIBC 2.38, не работает на системах со старыми GLIBC (2.31-2.35)
- **Ошибка:** `version 'GLIBC_2.38' not found`
- **Решение:** Docker-сборка на базе Ubuntu 20.04 (GLIBC 2.31) для максимальной совместимости

---

## Процесс сборки

1. ✅ Установка Python 3.12.7
2. ✅ Исправление Poetry через pipx
3. ✅ Обновление `pyproject.toml` для совместимости с Python 3.12
4. ✅ Пересоздание `poetry.lock` с корректными версиями
5. ✅ Создание виртуального окружения: `poetry install`
6. ✅ Обновление `main.py` для поиска `config.yaml` в правильных местах
7. ✅ Обновление `tuda-suda.spec` для автоматического копирования `config.yaml`
8. ✅ Сборка бинарника: `poetry run pyinstaller tuda-suda.spec`
9. ✅ Проверка работоспособности

## Исправленные проблемы

### Проблема с поиском config.yaml
- **Причина:** Приложение ищет `config.yaml` в `/src/../` что при сборке PyInstaller указывает на `/tmp`
- **Решение:** Обновлена логика поиска файла конфигурации:
  1. Рядом с исполняемым файлом (для скомпилированного приложения)
  2. В корне проекта (для разработки из исходника)
  3. В текущей директории
- **Дополнительно:** `config.yaml` автоматически копируется в `dist/` при сборке

---

## Запуск приложения

### Из исходного кода
```bash
poetry run python src/main.py
```

### Скомпилированный бинарник
```bash
./dist/tuda-suda
```

---

## Требования для запуска

- **ОС:** Linux (x86-64)
- **Библиотеки Qt:** стандартные в большинстве дистрибутивов
- **Конфиг:** `config.yaml` в директории запуска или рядом с бинарником

---

## Кроссплатформенная сборка (Docker)

Для совместимости со старыми системами используется Docker-сборка на базе Ubuntu 20.04:

### Сборка

```bash
cd distribution
./build_in_docker.sh

# Результат в distribution/dist-docker/
```

**Целевая система:** Ubuntu 20.04 (GLIBC 2.31)  
**Совместимость:** Все системы с GLIBC >= 2.31 (Ubuntu 20.04+, Debian 11+, RHEL 8+, Fedora 32+, и т.д.)

**Последняя сборка:** 25.12.2024  
**Статус:** ✅ Готово к тестированию

### Нативная сборка

Для быстрой сборки на целевой системе:

```bash
cd distribution
./build_native.sh

# Результат в distribution/dist-native/
```

**Подробности:** См. `distribution/README.md`

---

## Команды для разработки

```bash
# Запуск тестов
poetry run pytest -v

# Форматирование кода
poetry run black src/

# Сборка (см. distribution/README.md)
cd distribution && ./build_native.sh
```

---

**Дата сборки:** 25.12.2024 11:30 UTC+3  
**Версия приложения:** 0.1.0  
**Статус:** Ready for deployment ✅
